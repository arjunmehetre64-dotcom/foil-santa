<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Foil Santa Fast Roll First Appearance</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      touch-action: manipulation;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// Assets
const img = new Image();
img.src = "image.png";

const sounds = [
  new Audio("part1.wav"),
  new Audio("part2.wav"),
  new Audio("part3.wav")
];

let clickCount = 0;

// Santa state
let revealed = false;
let x = canvas.width / 2;
let y = canvas.height / 2;
let targetX = x;
let targetY = y;
let rotation = 0;
let rolling = false;
let rollingSpeed = 0.5; // rotation speed
let firstAppearanceRolling = 0; // counter to simulate fast roll on first appearance

canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  if (!revealed) {
    // First click anywhere â†’ Santa appears at click
    x = targetX = mx;
    y = targetY = my;
    revealed = true;

    // Enable rolling animation for first appearance
    firstAppearanceRolling = 15; // frames of fast spin
    rolling = false; // no movement yet

    // Play first sound immediately
    const s = sounds[0];
    s.currentTime = 0;
    s.play();
    clickCount = 1;
    return;
  }

  // Check click distance to Santa
  const dx = mx - x;
  const dy = my - y;
  const dist = Math.hypot(dx, dy);

  if (dist < 150 && !rolling) {
    // Play cycling sound
    const s = sounds[clickCount % 3];
    s.currentTime = 0;
    s.play();
    clickCount++;

    // Assign new target position
    let nx, ny;
    do {
      nx = Math.random() * canvas.width;
      ny = Math.random() * canvas.height;
    } while (Math.hypot(nx - mx, ny - my) < 200);

    targetX = nx;
    targetY = ny;
    rolling = true;
    rotation = 0;
  }
});

// Animation loop
function animate() {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  if (revealed) {

    // First appearance fast roll
    if (firstAppearanceRolling > 0) {
      rotation += rollingSpeed * 5 + Math.random() * 0.5; // very fast spin
      firstAppearanceRolling--;
    }
    // Santa movement rolling
    else if (rolling) {
      rotation += rollingSpeed * 2 + Math.random() * 0.3;
      x += (targetX - x) * 0.2;
      y += (targetY - y) * 0.2;
      if (Math.hypot(targetX - x, targetY - y) < 1) {
        x = targetX;
        y = targetY;
        rotation = 0;
        rolling = false;
      }
    } else {
      // tiny idle wobble
      rotation = Math.sin(Date.now() * 0.01) * 0.05;
    }

    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);
    ctx.drawImage(img, -img.width / 2, -img.height / 2);
    ctx.restore();
  }

  requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>
